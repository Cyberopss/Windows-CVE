**Introduction:**

CVE-2023-23397 stands out as a critical elevation of privilege (EoP) vulnerability within Microsoft Outlook, boasting a CVSS base score of 9.8. This security flaw came to light on March 14, 2023, and is attributed to APT28, also known as Fancy Bear or Strontium, a threat actor linked to the Russian General Staff Main Intelligence Directorate (GRU). The primary targets of this vulnerability are entities within the European government, military, and energy sectors.

The gravity of CVE-2023-23397 is underscored by its designation as a zero-touch exploit. This means that an attacker can exploit the vulnerability without any user interaction, leveraging a specific email or calendar item. In the event of a successful exploitation, the attacker gains access to the Net-NTLMv2 hash, which contains the encrypted user credentials. This critical vulnerability impacts all versions of the Outlook desktop app on any Windows system. Outlook web app (OWA) and Microsoft 365 aren't vulnerable since they do not support NTLM authentication.

Unlike most exploits, this one is particularly dangerous because it is a zero-click exploit, meaning no user interaction is required to trigger it. Once an infected email arrives in the user's inbox, the attacker can obtain sensitive Net-NTLMv2 credential hashes. Once malicious actors have those hashes, they can get a user's credentials, authenticate to their system and escalate privileges.

**Detection:**

There are many to detect this attack within the network. Each attack leaves patterns or artifacts that could help the detection team identify the threats.

**Nmap**

We can do network scanning in order to find out that SMB port 445 is open or not

**nmap -Pn -p 445 &lt;target_ip&gt;**

In this command:

**\- \`-Pn\`:** Treats all hosts as online and skips host discovery. This is helpful when the target host may be configured not to respond to ping requests.

**\- \`-p 445\`:** Specifies the port number (445 in this case) that you want to scan on the target host.

**\- \`&lt;target_ip&gt;\`:** Replace this with the actual IP address of the target machine.

**Sigma Rule:**

Sigma rules are a type of security information and event management (SIEM) content that enable organizations to standardize the detection of security events across different log sources and SIEM platforms. Sigma rules are written in a YAML-based language and are designed to be easily shareable and convertible across various SIEM solutions.

Here is the sigma detection rule for cve-2023-23397

title: CVE-2023-23397 Exploitation Attempt

id: 73c59189-6a6d-4b9f-a748-8f6f9bbed75c

status: experimental

description: Detects outlook initiating connection to a WebDAV or SMB share, which

could be a sign of CVE-2023-23397 exploitation.

author: Robert Lee @quantum_cookie

date: 2023/03/16

references:

\- <https://www.trustedsec.com/blog/critical-outlook-vulnerability-in-depth-technical-analysis-and-recommendations-cve-2023-23397/>

tags:

\- attack.credential_access

\- attack.initial_access

\- cve.2023.23397

logsource:

service: security

product: windows

definition: 'Requirements: SACLs must be enabled for "Query Value" on the registry

keys used in this rule'

detection:

selection:

EventID:

\- 4656

\- 4663

ProcessName|endswith: \\OUTLOOK.EXE

Accesses|contains: Query key value

ObjectName|contains|all:

\- \\REGISTRY\\MACHINE\\SYSTEM

\- Services\\

ObjectName|endswith:

\- WebClient\\NetworkProvider

\- LanmanWorkstation\\NetworkProvider

condition: selection

falsepositives:

\- Searchprotocolhost.exe likes to query these registry keys. To avoid false postives,

it's better to filter out those events before they reach the SIEM

level: critical

**Mitigation:**

The mitigation steps provided for CVE-2023-23997 indicate actions that organizations and system administrators can take to reduce the risk of exploitation and to enhance the security posture of their systems. Here's an explanation of the recommended mitigations:

**1\. Add Users to the Protected Users Security Group:**

**Objective:** The Protected Users Security Group is a security feature in Windows that enhances the security of user accounts. Adding users to this group enforces stronger security measures for authentication.

**NTLM Prevention:** The recommendation to add users to the Protected Users Security Group is aimed at preventing the use of NTLM (NT LAN Manager) as an authentication mechanism. NTLM is susceptible to certain attacks, and by using the Protected Users group, the system forces the use of more secure authentication mechanisms, such as Kerberos.

**2\. Block TCP 445/SMB Outbound:**

**Objective:** Blocking outbound traffic on TCP port 445, which is commonly associated with the Server Message Block (SMB) protocol, can help prevent post-exploitation connections and limit the impact of attacks.

**Firewall Rules:** System administrators can configure firewalls or network security devices to block outbound traffic on TCP port 445. This can be implemented at the network perimeter or within internal network segments.

**Inbound rule on Victim Machine**

Creating an inbound rule to block port 445 can be done using the Windows Firewall on a Windows system. Below are the steps to create such a rule:

**1\. Open Windows Defender Firewall:**

\- Press \`Win + S\` to open the Windows search bar.

\- Type "Firewall" and select "Windows Defender Firewall with Advanced Security."


**2\. Navigate to Inbound Rules:**

\- In the left pane, click on "Inbound Rules."


**3\. Create a New Rule:**

\- In the right pane, click on "New Rule..." to open the New Inbound Rule Wizard.


**4\. Select Rule Type:**

\- Choose "Port" and click "Next."


**5\. Specify Port:**

\- Select "Specific local ports" and enter \`445\` in the text box.

\- Click "Next."


**6\. Choose Action:**

\- Select "Block the connection" and click "Next."


**7\. Profile Settings:**

\- Choose when to apply the rule (typically, select all three profiles: Domain, Private, Public).

\- Click "Next."


**8\. Name and Description:**

\- Provide a name and description for the rule (e.g., "Block Port 445").

\- Click "Finish."

The inbound rule to block port 445 is now created.
